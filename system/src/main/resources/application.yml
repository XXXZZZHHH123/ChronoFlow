spring:
  application:
    name: ChronoFLow
  devtools:
    restart:
      enabled: false
  # Data source
  datasource:
    url: jdbc:mysql://${DB_HOST}:${DB_PORT}/${DB_NAME}?useUnicode=true&characterEncoding=utf8&zeroDateTimeBehavior=convertToNull&useSSL=true&serverTimezone=GMT%2B8
    username: ${DB_USER}
    password: ${DB_PASSWORD}
    # Database connection pool
    hikari:
      # min free connection
      minimum-idle: 5
      # max connection
      maximum-pool-size: 20
      # free connection existence time
      idle-timeout: 300000
      # max lifetime of connection
      max-lifetime: 900000
      connection-timeout: 30000
    driver-class-name: com.mysql.cj.jdbc.Driver

  profiles:
    active: ${SPRING_PROFILES_ACTIVE:dev} # Default is dev  Can modified by environment variable
  data:
    redis:
      repositories:
        enabled: false
      lettuce:
        pool:
          # 连接池最大连接数
          max-active: 200
          # 连接池最大阻塞等待时间（使用负值表示没有限制）
          max-wait: -1ms
          # 连接池中的最大空闲连接
          max-idle: 10
          # 连接池中的最小空闲连接
          min-idle: 0
  main:
    allow-circular-references: true
  # Servlet 配置
  servlet:
    # 文件上传相关配置项
    multipart:
      max-file-size: 16MB # 单个文件大小
      max-request-size: 32MB # 设置总上传的文件大小

  # Jackson 配置项
  jackson:
    serialization:
      write-dates-as-timestamps: true # 设置 Date 的格式，使用时间戳
      write-date-timestamps-as-nanoseconds: false # 设置不使用 nanoseconds 的格式。例如说 1611460870.401，而是直接 1611460870401
      write-durations-as-timestamps: true # 设置 Duration 的格式，使用时间戳
      fail-on-empty-beans: false # 允许序列化无属性的 Bean

mybatis-plus:
  configuration:
    map-underscore-to-camel-case: true            # db: user_name -> java: userName
    cache-enabled: false
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl  # dev-only SQL logs
  global-config:
    db-config:
      id-type: ASSIGN_ID     # snowflake-style; or AUTO for DB auto-increment
      table-underline: true

# 项目相关配置
chronoflow:
  name: ChronoFlow
  version: 1.0.0
  base-package: nus.edu.u
  security:
    refresh-token-expire: 604800
  swagger:
    title: ChronoFLow Platform
    version: ${chronoflow.version}

server:
  servlet:
    encoding:
      enabled: true
      charset: UTF-8 # 必须设置 UTF-8，避免 WebFlux 流式返回（AI 场景）会乱码问题
      force: true

--- #################### API doc configuration ####################
springdoc:
  api-docs:
    enabled: true
    path: /v3/api-docs
  swagger-ui:
    enabled: true
    path: /swagger-ui
  default-flat-param-object: true

knife4j:
  enable: false
  setting:
    language: zh_cn


# log file address
logging:
  file:
    name: ${user.home}/logs/${spring.application.name}.log

############## Sa-Token 配置 (文档: https://sa-token.cc) ##############
sa-token:
  # token 名称（同时也是 cookie 名称）
  token-name: Authentication
  token-prefix: Bearer
  # Read token from cookie
  is-read-cookie: false
  # token 有效期（单位：秒） 默认30天，-1 代表永久有效
  timeout: 1800
  # token 最低活跃频率（单位：秒），如果 token 超过此时间没有访问系统就会被冻结，默认-1 代表不限制，永不冻结
  active-timeout: -1
  # 是否允许同一账号多地同时登录 （为 true 时允许一起登录, 为 false 时新登录挤掉旧登录）
  is-concurrent: true
  # 在多人登录同一账号时，是否共用一个 token （为 true 时所有登录共用一个 token, 为 false 时每次登录新建一个 token）
  is-share: true
  # 是否输出操作日志
  is-log: true
  # Jwt key
  jwt-secret-key: chronoflow123
  # Token style
  token-style: uuid
